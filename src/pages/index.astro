---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const base = import.meta.env.BASE_URL || '/';
---

<BaseLayout
  title="Astro Minimal Starter"
  description="Static, file-based routing with content collections and Markdown blog posts."
>
  <section class="hero">
    <span class="pill">Static • Markdown • GitHub Pages ready</span>
    <h1>Build a fast Astro site with content collections</h1>
    <p class="muted">
      File-based routing, Markdown-powered posts, and a global style sheet out of the box. Deploy the
      generated static build straight to GitHub Pages.
    </p>
    <div class="grid">
      <div class="card">
        <h3>Static site generation</h3>
        <p class="muted">Astro builds HTML at compile time, perfect for GitHub Pages hosting.</p>
      </div>
      <div class="card">
        <h3>Content collections</h3>
        <p class="muted">Type-safe Markdown for blog posts in `src/content/blog`.</p>
      </div>
      <div class="card">
        <h3>Global styles</h3>
        <p class="muted">Edit `src/styles/global.css` to brand the entire site.</p>
      </div>
    </div>
  </section>

  <section>
    <h2>Latest posts</h2>
    <div class="posts">
      {posts.map((post) => (
        <a class="post-card" href={`${base}blog/${post.slug}/`}>
          <div class="post-body">
            <div class="post-meta">{post.data.pubDate.toLocaleDateString()}</div>
            <h3>{post.data.title}</h3>
            <p class="muted">{post.data.description}</p>
          </div>
        </a>
      ))}
    </div>
  </section>
</BaseLayout>
